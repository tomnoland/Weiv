#!/bin/sh
################################################################################
###
###	This script packs the contents of the working directory into a jar file
###	The jarfile contains the runbashscript class files and the unpack script
###	
################################################################################
###
###
################################################################################



################################################################################
###
###	Extract (all) files from running jarfile to working folder
###	
################################################################################
jar -xf $JARFILE_PATH runbashscript
################################################################################












################################################################################
###**************************************************************************###
###**************************************************************************###
################################################################################
###
###	SPECIAL SECTION
###	Write script.sh
###	
################################################################################
FILE="script.sh"
/bin/cat <<'EOM' >$FILE
#!/bin/sh
################################################################################
###
###	This script extracts the contents of the jarfile into a working directory
###	
################################################################################
###
###	Create a working folder with the name "$JARFILE_NAME"
###	
###	Extract (all) files from running jarfile to working folder
###	
###	Delete unnecessary files and folders (META-INF, etc)
###	
###	Delete the currently running jarfile ($JARFILE_NAME.jar)
###	
################################################################################


################################################################################
###
###	Create a working folder with the name "$JARFILE_NAME"
###	
################################################################################
mkdir $JARFILE_NAME
cd $PARENT_DIRECTORY/$JARFILE_NAME
################################################################################



################################################################################
###
###	Extract (all) files from running jarfile to working folder
###	
################################################################################
jar -xf $JARFILE_PATH
################################################################################



################################################################################
###
###	Delete unnecessary files and folders (META-INF, etc)
###	
################################################################################
rm -r META-INF
rm script.sh
rm -r runbashscript
################################################################################



################################################################################
#
#
#
################################################################################
####
####	Delete the currently running jarfile ($JARFILE_NAME.jar)
####	
################################################################################
filetime=$(date +%Y%m%d_%H%M%S)
mv ../$JARFILE_NAME.jar ../${JARFILE_NAME}_${filetime}.jar
#rm ../$JARFILE_NAME.jar
################################################################################
EOM
################################################################################
###**************************************************************************###
###**************************************************************************###
################################################################################


#{_[0-9]{1,3}_[0-9]{1,3}}
#
#
#filetime=$(date +%Y%m%d_%H%M%S)
#
#echo ${PARENT_DIRECTORY_NAME}_${filetime}.jar>../ddd.txt
#
#
#XXX=${PARENT_DIRECTORY_NAME}_${filetime}
#
#echo ${XXX//_[0-9]{1,8}_[0-9]{1,8}/}.jar>../eee.txt
#echo ${XXX//[0-9]+/@}>../fff.txt

################################################################################
###
###	Set main class and create the jarfile
###	
################################################################################
JARFILE_MAIN_CLASS=runbashscript.RunBashScript
/usr/bin/jar -cfe ${PARENT_DIRECTORY_NAME}.jar $JARFILE_MAIN_CLASS *
#/usr/bin/jar -cfe ${PARENT_DIRECTORY_NAME}_${filetime}.jar $JARFILE_MAIN_CLASS *
#/usr/bin/jar -cfe ${XXX}.jar $JARFILE_MAIN_CLASS *
#mv ${PARENT_DIRECTORY_NAME}.jar ${PARENT_DIRECTORY_NAME}_${filetime}.jar
################################################################################



################################################################################
###
###	Set
###	
################################################################################
mv ${PARENT_DIRECTORY_NAME}.jar ..
cd ..
rm -r $PARENT_DIRECTORY_NAME
################################################################################