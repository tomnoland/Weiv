#!/bin/sh
################################################################################
###
###	This script packs the contents of the working directory into a jar file
###	The jarfile contains the runbashscript class files and the unpack script
###	
################################################################################
###
###
################################################################################



################################################################################
###
###	Extract (all) files from running jarfile to working folder
###	
################################################################################
jar -xf $JARFILE_PATH runbashscript
################################################################################












################################################################################
###**************************************************************************###
###**************************************************************************###
################################################################################
###
###	SPECIAL SECTION
###	Write script.sh
###	
################################################################################
FILE="script.sh"
/bin/cat <<'EOM' >$FILE
#!/bin/sh
################################################################################
###
###	This script extracts the contents of the jarfile into a working directory
###	
################################################################################
###
###	Create a working folder with the name "$JARFILE_NAME"
###	
###	Extract (all) files from running jarfile to working folder
###	
###	Delete unnecessary files and folders (META-INF, etc)
###	
###	Delete the currently running jarfile ($JARFILE_NAME.jar)
###	
################################################################################


################################################################################
###
###	Create a working folder with the name "$JARFILE_NAME"
###	
################################################################################
mkdir $JARFILE_NAME
cd $PARENT_DIRECTORY/$JARFILE_NAME
################################################################################



################################################################################
###
###	Extract (all) files from running jarfile to working folder
###	
################################################################################
jar -xf $JARFILE_PATH
################################################################################



################################################################################
###
###	Delete unnecessary files and folders (META-INF, etc)
###	
################################################################################
rm -r META-INF
rm script.sh
rm -r runbashscript
################################################################################



################################################################################
#
#
#
################################################################################
####
####	Delete the currently running jarfile ($JARFILE_NAME.jar)
####	
################################################################################
rm ../$JARFILE_NAME.jar
################################################################################
EOM
################################################################################
###**************************************************************************###
###**************************************************************************###
################################################################################














################################################################################
###
###	Set main class and create the jarfile
###	
################################################################################
JARFILE_MAIN_CLASS=runbashscript.RunBashScript
/usr/bin/jar -cfe $PARENT_DIRECTORY_NAME.jar $JARFILE_MAIN_CLASS *
################################################################################



################################################################################
###
###	Set
###	
################################################################################
mv $PARENT_DIRECTORY_NAME.jar ..
cd ..
rm -r $PARENT_DIRECTORY_NAME
################################################################################